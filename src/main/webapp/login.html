<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/fondos_recursos/flor.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet">
    <title>Log In / Sign In - Luría</title>
</head>
<body>
<div class="container">
    <div class="tabs">
        <button id="loginTab" class="active">Log In</button>
        <button id="registerTab">Sign In</button>
    </div>
    <div id="loginForm" class="form active">
        <h3>Log In</h3>
        <label>E-mail: <input type="email" id="email" placeholder="Correo electrónico" required></label><br>
        <label>Password: <input type="password" id="contrasenaLogin" placeholder="Contraseña" required></label><br>
        <button id="loginButton">Log In</button>
        <p class="message">Don't you have an account? Then <a href="#" id="goToRegister">Sign In</a></p>
        <div id="loginError" class="error-message" style="display:none;"></div>
    </div>
    <div id="registerForm" class="form">
        <h3>Sign In</h3>
        <label>User: <input type="text" id="nombre" placeholder="User" required></label><br>
        <label>E-mail: <input type="email" id="emailRegistro" placeholder="E-mail" required></label><br>
        <label>Password: <input type="password" id="contrasenaRegistro" placeholder="Password" required></label><br>
        <label>Telephone: <input type="text" id="telefono" placeholder="Telephone" required></label><br>
        <button id="registerButton">Sign In</button>
        <p class="message">Do you have an account already? <a href="#" id="goToLogin">Log In</a></p>
        <div id="registerError" class="error-message" style="display:none;"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const goToRegister = document.getElementById('goToRegister');
        const goToLogin = document.getElementById('goToLogin');
        const loginButton = document.getElementById('loginButton');
        const registerButton = document.getElementById('registerButton');
        const loginError = document.getElementById('loginError');
        const registerError = document.getElementById('registerError');

        loginTab.addEventListener('click', () => {
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
        });

        registerTab.addEventListener('click', () => {
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
        });

        goToRegister.addEventListener('click', (e) => {
            e.preventDefault();
            registerTab.click();
        });

        goToLogin.addEventListener('click', (e) => {
            e.preventDefault();
            loginTab.click();
        });

        loginButton.addEventListener('click', async () => {
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('contrasenaLogin');
            const email = emailInput.value;
            const contrasena = passwordInput.value;

            loginError.textContent = ""; // Limpiar errores anteriores

            const response = await fetch('/webapp-1.0-SNAPSHOT/control?action=login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, contrasena })
            });

            const result = await response.json();

            if (result.status === 'ok') {
                if (result.rol === 'admin') {
                    window.location.href = '/webapp-1.0-SNAPSHOT/jsp/adminintranet.jsp';
                } else if (result.rol === 'empleado') {
                    window.location.href = '/webapp-1.0-SNAPSHOT/jsp/empleadointranet.jsp';
                } else {
                    window.location.href = '/webapp-1.0-SNAPSHOT/index.html'; // Redirigir a la página principal
                }
            } else {
                loginError.textContent = result.message;
                loginError.style.display = 'block';
            }
        });

        registerButton.addEventListener('click', async () => {
            const nombreInput = document.getElementById('nombre');
            const emailInput = document.getElementById('emailRegistro');
            const passwordInput = document.getElementById('contrasenaRegistro');
            const telefonoInput = document.getElementById('telefono');

            const nombre = nombreInput.value;
            const email = emailInput.value;
            const contrasena = passwordInput.value;
            const telefono = telefonoInput.value;

            registerError.textContent = ""; // Limpiar errores anteriores

            const response = await fetch('/webapp-1.0-SNAPSHOT/control?action=registro', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, email, contrasena, telefono })
            });

            const result = await response.json();

            if (result.status === 'ok') {
                alert('Registro exitoso. Por favor, inicia sesión.');
                loginTab.click(); // Cambiar al tab de login
            } else {
                registerError.textContent = result.message || 'Error al registrar usuario.';
                registerError.style.display = 'block';
            }
        });
    });
</script>
</body>
</html>