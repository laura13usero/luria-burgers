<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Hamburguesas</title>
    <script>
        async function obtenerHamburguesas() {
          try {
            const response = await fetch("control?action=getHamburguesasJSON");
            const data = await response.json();
            const hamburguesasContainer = document.getElementById('hamburguesas-list');
            hamburguesasContainer.innerHTML = '';

            if (data.length > 0) {
              data.forEach(hamburguesa => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                  <strong>${hamburguesa.nombre}</strong> - ${hamburguesa.descripcion || ''}
                  <br>
                  <button onclick="agregarAlCarrito(${hamburguesa.id}, 'hamburguesa')">
                    Añadir al carrito por: $${hamburguesa.precio}
                  </button>
                `;
                hamburguesasContainer.appendChild(listItem);
              });
            } else {
              hamburguesasContainer.innerHTML = '<p>No hay hamburguesas disponibles.</p>';
            }
          } catch (error) {
            console.error('Error al obtener hamburguesas:', error);
          }
        }

        async function agregarAlCarrito(idProducto, tipoProducto) {
          try {
            const response = await fetch(`control?action=addToCart&idProducto=${idProducto}`, {
              method: "POST"
            });

            const result = await response.json();

            if (result.status === "ok") {
              window.location.href = result.redirect;
            } else if (result.status === "login_required") {
              window.location.href = result.redirect;
            } else {
              alert("❌ Error al añadir al carrito: " + result.message);
            }
          } catch (error) {
            console.error("❌ Error de red al añadir al carrito:", error);
            alert("❌ Error inesperado.");
          }
        }

        document.addEventListener('DOMContentLoaded', obtenerHamburguesas);
    </script>
</head>
<body>
<h1>Hamburguesas disponibles</h1>
<ul id="hamburguesas-list"></ul>

<button onclick="window.location.href = 'index.html'" style="margin-top: 10px;">Volver a inicio</button>
<button onclick="window.location.href = 'carrito.html'" style="margin-top: 10px;">Ver carrito</button>
</body>
</html>
